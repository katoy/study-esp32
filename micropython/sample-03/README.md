# ESP32 ESP-NOW LEDコントロールサンプル

このプロジェクトは、MicroPythonを搭載したESP32ボードでESP-NOWプロトコルを使用し、一方のボードのボタンでもう一方のボードのLEDを制御する方法を実演するものです。

## 概要

このシステムは2台のESP32ボードで構成されます。

1.  **送信側 (Sender)**: `sender.py`スクリプトを実行します。内蔵のBOOTボタンが押されて離されると、「on」または「off」のメッセージを送信します。
2.  **受信側 (Receiver)**: `recever.py`スクリプトを実行します。送信側からのメッセージを待ち受け、受信したメッセージに基づいてGPIOに接続された外部LEDを制御します。

## ファイル構成

-   `sender.py`: 送信側ボードのメインスクリプト。BOOTボタンを使って状態を切り替え、対応するメッセージ（`b'on'`または`b'off'`）をESP-NOWでブロードキャスト送信します。基板上のLEDが現在の状態を反映します。
-   `recever.py`: 受信側ボードのメインスクリプト。ESP-NOWメッセージを待ち受け、GPIO 19に接続されたLEDをオン/オフします。
-   `espnow_utils.py`: 送信側と受信側の両方で使われるユーティリティモジュール。Wi-FiとESP-NOWインターフェースを初期化します。
-   `sender_0.py`: テスト用のシンプルな別バージョンの送信スクリプト。ボタン入力なしで2秒ごとに自動的に「on」と「off」のメッセージを送信します。

## 必要なハードウェア

-   ESP32開発ボード x2
-   LED x1
-   抵抗器（例: 220Ωまたは330Ω）x1
-   ジャンパーワイヤー

## セットアップと使い方

### 1. 配線

-   **送信側ボード**: 外部配線は不要です。スクリプトは基板上のBOOTボタン（GPIO 0）とステータスLED（GPIO 2）を使用します。
-   **受信側ボード**: GPIO 19にLEDを接続します。
    -   LEDの長い方の足（アノード）をGPIO 19に接続します。
    -   LEDの短い方の足（カソード）を抵抗の一方の端に接続します。
    -   抵抗のもう一方の端をGNDピンに接続します。

### 2. ソフトウェアのセットアップ

1.  両方のESP32ボードにMicroPythonを書き込みます。
2.  Thonnyや`ampy`などのツールを使って、各ボードに必要なファイルをアップロードします。
    -   **両方のボードに**: 
        -   `espnow_utils.py`
    -   **送信側ボードに**:
        -   `sender.py`
    -   **受信側ボードに**:
        -   `recever.py`

### 3. 実行

1.  両方のボードの電源を入れます。PCに接続し、シリアルモニター（Thonnyのエディタなど）で出力を確認できます。
2.  受信側ボードのシリアルモニターに `Waiting for messages...` と表示されます。
3.  送信側ボードの**BOOTボタン**を押して離します。
4.  送信側のシリアルモニターに `Sending on...` のようなメッセージが表示され、基板上のLEDが点灯します。
5.  受信側のシリアルモニターに `Received message...` というメッセージが表示され、外部接続したLEDが点灯します。
6.  もう一度BOOTボタンを押して離すと、`off` メッセージが送信され、両方のLEDが消灯します。